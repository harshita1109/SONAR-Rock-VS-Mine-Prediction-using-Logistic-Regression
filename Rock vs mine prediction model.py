# -*- coding: utf-8 -*-
"""SONAR (Rock vs mine) LogR.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1A961EWaU3IqJ_umSIRb-LmmYM0mes-vy
"""

# Importing Libraries
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

df=pd.read_csv('/content/drive/MyDrive/Copy of sonar data.csv')

df

df.info()

# Preprocessing the data
df.isnull().sum().sum()

df.duplicated().sum()

df.describe()

df.shape

# Checking for outliers
for x in df.columns:
  if df[x].dtype=='float64':
    sns.boxplot(df[x])
    plt.show()

df['R'].value_counts()

X=df.drop(['R'],axis=1)

X

y=df['R']
y

# Feature Selection
from sklearn.preprocessing import StandardScaler
scaler=StandardScaler()
X=scaler.fit_transform(X)

# Training the model
from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)

from sklearn.linear_model import LogisticRegression
model=LogisticRegression()

model.fit(X_train,y_train)

y_pred=model.predict(X_test)

from sklearn.metrics import accuracy_score
accuracy_score(y_pred,y_test)*100

from sklearn.svm import SVC
svm_model=SVC()
svm_model.fit(X_train,y_train)

y_pred=svm_model.predict(X_test)
y_pred

from sklearn.metrics import accuracy_score
accuracy_score(y_pred,y_test)*100

# Finalising the model
from sklearn.ensemble import RandomForestClassifier
final_model=RandomForestClassifier()
final_model.fit(X_train,y_train)

y_pred=final_model.predict(X_test)
y_pred

from sklearn.metrics import accuracy_score
accuracy_score(y_pred,y_test)*100

# making predictions
unseen_sample1 = np.array([[
    0.021, 0.037, 0.045, 0.062, 0.088, 0.102, 0.134, 0.176, 0.221, 0.245,
    0.278, 0.301, 0.337, 0.362, 0.388, 0.415, 0.441, 0.462, 0.489, 0.512,
    0.534, 0.558, 0.572, 0.589, 0.601, 0.617, 0.633, 0.649, 0.661, 0.674,
    0.689, 0.702, 0.718, 0.734, 0.748, 0.761, 0.775, 0.789, 0.803, 0.817,
    0.829, 0.842, 0.855, 0.868, 0.879, 0.891, 0.903, 0.914, 0.926, 0.937,
    0.949, 0.958, 0.967, 0.975, 0.983, 0.989, 0.993, 0.996, 0.998, 1.000
]])

unseen_sample_2=np.array([[0.0298,0.0615,0.0650,0.0921,0.1615,0.2294,0.2176,0.2033,0.1459,0.0852,0.2476,0.3645,0.2777,0.2826,0.3237,0.4335,0.5638,0.4555,0.4348,0.6433,0.3932,0.1989,0.3540,0.9165,0.9371,0.4620,0.2771,0.6613,0.8028,0.4200,0.5192,0.6962,0.5792,0.8889,0.7863,0.7133,0.7615,0.4401,0.3009,0.3163,0.2809,0.2898,0.0526,0.1867,0.1553,0.1633,0.1252,0.0748,0.0452,0.0064,0.0154,0.0031,0.0153,0.0071,0.0212,0.0076,0.0152,0.0049,0.0200,0.0073]])

unseen_scaled_2 = scaler.transform(unseen_sample_2)

prediction = model.predict(unseen_scaled_2)
print(prediction)

unseen_sample_3=np.array([[0.0715,0.0849,0.0587,0.0218,0.0862,0.1801,0.1916,0.1896,0.2960,0.4186,0.4867,0.5249,0.5959,0.6855,0.8573,0.9718,0.8693,0.8711,0.8954,0.9922,0.8980,0.8158,0.8373,0.7541,0.5893,0.5488,0.5643,0.5406,0.4783,0.4439,0.3698,0.2574,0.1478,0.1743,0.1229,0.1588,0.1803,0.1436,0.1667,0.2630,0.2234,0.1239,0.0869,0.2092,0.1499,0.0676,0.0899,0.0927,0.0658,0.0086,0.0216,0.0153,0.0121,0.0096,0.0196,0.0042,0.0066,0.0099,0.0083,0.0124]])

unseen_scaled_3=scaler.transform(unseen_sample_3)

prediction = model.predict(unseen_scaled_3)
print(prediction)

import pickle

pickle.dump(final_model, open("sonar_model.pkl", "wb"))
pickle.dump(scaler, open("sonar_scaler.pkl", "wb"))

import gradio as gr
import numpy as np
import pickle

# -----------------------------
# Load model and scaler
# -----------------------------
model = pickle.load(open("sonar_model.pkl", "rb"))
scaler = pickle.load(open("sonar_scaler.pkl", "rb"))

# -----------------------------
# Prediction function
# -----------------------------
def predict_sonar(*features):
    # Convert inputs to numpy array
    input_data = np.array(features).reshape(1, -1)

    # Scale input
    scaled_input = scaler.transform(input_data)

    # Predict
    prediction = model.predict(scaled_input)[0]

    if prediction == "R":
        return "ðŸª¨ Rock Detected"
    else:
        return "ðŸ’£ Mine Detected"

# -----------------------------
# Create 60 input fields
# -----------------------------
inputs = [
    gr.Number(label=f"Feature {i+1}", value=0.0)
    for i in range(60)
]

# -----------------------------
# Gradio Interface
# -----------------------------
app = gr.Interface(
    fn=predict_sonar,
    inputs=inputs,
    outputs=gr.Textbox(label="Prediction Result"),
    title="ðŸŒŠ SONAR Rock vs Mine Prediction System",
    description=(
        "This application predicts whether a SONAR signal corresponds "
        "to a **Rock** or a **Mine** using a trained Machine Learning model."
    ),
    theme="default"
)

# -----------------------------
# Launch app
# -----------------------------
app.launch(share=True)   # share=True for Colab

!pip install gradio



